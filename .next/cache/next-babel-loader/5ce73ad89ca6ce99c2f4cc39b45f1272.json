{"ast":null,"code":"import _JSXStyle from \"styled-jsx/style\";\nvar __jsx = React.createElement;\nimport React from 'react';\n\nfunction Loadphoto({\n  srcEv,\n  data,\n  de\n}) {\n  const uploadBu = e => {\n    //上传图片按钮事件\n    e.target.nextElementSibling.click();\n  };\n\n  const fileChange = e => {\n    //上传图片文件解析事件       \n    let img = document.createElement('img');\n    img.src = URL.createObjectURL(e.target.files[0]);\n    e.target.value = '';\n\n    img.onload = () => {\n      document.querySelector('.photo-container').append(img);\n      canvasFunc(img.offsetWidth, img.offsetHeight, img, srcEv, de);\n    };\n  };\n\n  return __jsx(React.Fragment, null, __jsx(\"button\", {\n    onClick: uploadBu,\n    className: \"jsx-3194263820\"\n  }, \"\\u66F4\\u6362\\u5934\\u50CF\"), __jsx(\"input\", {\n    type: \"file\",\n    name: \"avatar-photo\",\n    id: \"photo\",\n    onChange: fileChange,\n    hidden: true,\n    className: \"jsx-3194263820\"\n  }), __jsx(\"div\", {\n    style: {\n      position: 'fixed',\n      left: 0,\n      top: 0,\n      visibility: 'hidden',\n      userSelect: 'none'\n    },\n    className: \"jsx-3194263820\" + \" \" + \"photo-container\"\n  }), __jsx(\"canvas\", {\n    id: \"canvas\",\n    hidden: true,\n    className: \"jsx-3194263820\"\n  }), __jsx(\"canvas\", {\n    id: \"canvas2\",\n    hidden: true,\n    className: \"jsx-3194263820\"\n  }), __jsx(_JSXStyle, {\n    id: \"3194263820\"\n  }, [\"button.jsx-3194263820{background:none;border:none;outline:none;color:#1f2738;font-weight:700;}\"]));\n}\n\nexport default Loadphoto;\n\nconst canvasFunc = (W, H, img, setEv, de) => {\n  let canvas = document.getElementById('canvas');\n  let ctx = canvas.getContext('2d');\n  let count = Math.min(W, H);\n  canvas.width = count;\n  canvas.height = count;\n  let w = (Math.max(W, H) - count) / 2;\n  W > H ? ctx.drawImage(img, -w, 0) : ctx.drawImage(img, 0, -w); //裁减成一比一\n\n  let ctx2 = document.getElementById('canvas2').getContext('2d');\n  canvas2.width = 400;\n  canvas2.height = 400;\n  ctx2.drawImage(canvas, 0, 0, 400, 400); // 缩放成40px 40px\n\n  document.getElementById('canvas2').toBlob(blob => {\n    // 输出图片\n    let formData = new FormData();\n    formData.append(\"file\", blob, \"image.png\");\n    fetch('http://localhost:3001/upload/avatar', {\n      method: 'POST',\n      body: formData,\n      credentials: \"include\"\n    }).then(res => res.blob()).then(result => {\n      de();\n      setEv(URL.createObjectURL(result));\n    });\n  }, 'image/png');\n};","map":null,"metadata":{},"sourceType":"module"}