{"ast":null,"code":"import _JSXStyle from \"styled-jsx/style\";\nvar __jsx = React.createElement;\nimport React, { useState } from 'react';\nimport Loading from '../public/loading';\n\nfunction Form({\n  errorEv,\n  closeEv\n}) {\n  const {\n    0: fetching,\n    1: setFetching\n  } = useState(false);\n\n  const submit = e => {\n    e.preventDefault();\n    let form = e.currentTarget;\n    setFetching(true);\n    fetch('http://localhost:3001/login/registered', {\n      method: 'POST',\n      body: new FormData(e.currentTarget) //自动格式选择 form格式\n\n    }).then(res => {\n      if (res.ok) {\n        return res.json();\n      } else {\n        setFetching(false);\n        res.json().then(error => {\n          //请求错误处理\n          console.log(error);\n\n          if (error.includes('account')) {\n            form.account.closest('.account').classList.add('error');\n            errorEv('账号已经被使用');\n          }\n\n          if (error.includes('email')) {\n            form.email.closest('.email').classList.add('error');\n            errorEv('账号已经被使用');\n          }\n        });\n      }\n    }).then(result => {\n      //请求成功处理\n      if (result) {\n        try {\n          Array.from(form.querySelectorAll('.error')).forEach(item => item.classList.remove('error'));\n          errorEv('');\n          closeEv();\n          form.querySelectorAll('input').forEach(e => {\n            //清空输入值\n            if (e.type !== 'submit') {\n              console.log('test');\n              e.value = '';\n            }\n          });\n        } catch (err) {\n          console.log(err);\n        }\n      }\n    });\n  };\n\n  return __jsx(\"form\", {\n    onSubmit: submit,\n    className: \"jsx-1797463222\"\n  }, __jsx(\"div\", {\n    className: \"jsx-1797463222\" + \" \" + \"account\"\n  }, __jsx(\"input\", {\n    type: \"text\",\n    name: \"account\",\n    id: \"account\",\n    placeholder: \"account\",\n    required: true,\n    className: \"jsx-1797463222\"\n  })), __jsx(\"div\", {\n    className: \"jsx-1797463222\" + \" \" + \"email\"\n  }, __jsx(\"input\", {\n    type: \"email\",\n    name: \"email\",\n    id: \"email\",\n    placeholder: \"email\",\n    required: true,\n    className: \"jsx-1797463222\"\n  })), __jsx(\"div\", {\n    className: \"jsx-1797463222\" + \" \" + \"password\"\n  }, __jsx(\"input\", {\n    type: \"password\",\n    name: \"password\",\n    id: \"password\",\n    placeholder: \"password\",\n    required: true,\n    className: \"jsx-1797463222\"\n  })), __jsx(\"div\", {\n    className: \"jsx-1797463222\" + \" \" + \"submit\"\n  }, fetching ? __jsx(Loading, {\n    color: \"#495e87\"\n  }) : __jsx(\"input\", {\n    type: \"submit\",\n    value: \"Continue\",\n    className: \"jsx-1797463222\"\n  })), __jsx(_JSXStyle, {\n    id: \"1797463222\"\n  }, [\"form.jsx-1797463222{width:80%;background:white;margin:0 auto;margin-top:8vh;padding:4vh 0;border-radius:12px;box-shadow:0 0 2px #eee;}\", \"form.jsx-1797463222>div.jsx-1797463222{width:80%;margin:0 auto;margin-bottom:4vh;border-radius:12px;}\", \"form.jsx-1797463222 .submit.jsx-1797463222{margin-bottom:0;}\", \"form.jsx-1797463222 input.jsx-1797463222{width:100%;height:6vh;font-size:3vh;border:solid #eee 2px;border-radius:12px;box-shadow:0 0 4px #eee;box-sizing:border-box;padding:2vh;outline:none;-webkit-animation:load-jsx-1797463222 1s;animation:load-jsx-1797463222 1s;}\", \"form.jsx-1797463222 input[type='submit'].jsx-1797463222{color:white;background:#495e87;padding:0;border:none;}\", \".error.jsx-1797463222{box-shadow:0 0px 4px red;}\", \"form.jsx-1797463222 input[type='submit'].jsx-1797463222:hover{box-shadow:0 0 8px #888;}\", \"form.jsx-1797463222 input[type='submit'].jsx-1797463222:active{box-shadow:0 0 0;}\", \"@-webkit-keyframes load-jsx-1797463222{0%{opacity:0;-webkit-transform:translate(100px,0);-ms-transform:translate(100px,0);transform:translate(100px,0);}100%{opacity:1;-webkit-transform:translate(0,0);-ms-transform:translate(0,0);transform:translate(0,0);}}\", \"@keyframes load-jsx-1797463222{0%{opacity:0;-webkit-transform:translate(100px,0);-ms-transform:translate(100px,0);transform:translate(100px,0);}100%{opacity:1;-webkit-transform:translate(0,0);-ms-transform:translate(0,0);transform:translate(0,0);}}\"]));\n}\n\nexport default Form;","map":null,"metadata":{},"sourceType":"module"}