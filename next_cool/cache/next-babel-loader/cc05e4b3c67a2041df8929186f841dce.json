{"ast":null,"code":"import _Promise from \"@babel/runtime-corejs2/core-js/promise\";\nimport _JSXStyle from \"styled-jsx/style\";\nvar __jsx = React.createElement;\nimport React, { useState } from 'react';\nimport Top from './addPhototop';\nimport Content from './addphotolist';\nimport Form from './postform/form';\nimport AddBu from './addbu';\nimport { useRouter } from 'next/router';\n\nfunction AddPhoto() {\n  const data = useRouter();\n  const {\n    0: PhotoFiles,\n    1: setPhotoFiles\n  } = useState([]);\n  const fileRef = React.createRef(); // file Dom 定义\n\n  let canvasRef;\n\n  const fileClick = () => {\n    // 添加图片FileDOM 点击事件\n    fileRef.current.click();\n  };\n\n  const uploadPhoto = async e => {\n    e.preventDefault();\n\n    if (PhotoFiles.length < 1) {\n      // 检测是否有照片添加\n      let reming = document.querySelector('.remind');\n      reming.hidden = false;\n      setTimeout(() => reming.hidden = true, 2000);\n      return;\n    } // 添加信息和照片到服务器\n\n\n    const formData = new FormData(e.target);\n    formData.delete('photoFile');\n    let filesPromises = PhotoFiles.map(async photo => {\n      let img = new Image();\n      img.src = URL.createObjectURL(photo.file);\n      let promise = new _Promise(resolve => {\n        img.onload = () => {\n          let {\n            width,\n            height\n          } = img;\n          let size = width > height ? heigt : width;\n          let count = width > height ? width - size : height - size;\n          let countAr = width > height ? [-count, 0] : [0, -count];\n          canvasRef.width = size;\n          canvasRef.height = size;\n          canvasRef.getContext('2d').drawImage(img, ...countAr);\n          canvasRef.toBlob(blob => {\n            resolve(blob);\n          });\n        };\n      });\n      let blob;\n      await promise.then(result => blob = result);\n      let file = new File([blob], photo.file.name, {\n        type: photo.file.type\n      });\n      return file;\n    });\n    let files;\n    await _Promise.all(filesPromises).then(file => files = file);\n    files.forEach(file => {\n      formData.append('photoFile', file);\n    });\n    if (!data.account) return alert('未获取作者 程序错误');\n    formData.append('name', name.textContent);\n\n    (async () => {\n      let require = await fetch('http://localhost:3001/getphoto/post', {\n        method: 'POST',\n        body: formData\n      });\n\n      let res = await require.json();\n      if (res) console.log(res);\n    })();\n  };\n\n  return __jsx(\"div\", {\n    className: \"jsx-2222252425\" + \" \" + 'add-photo'\n  }, __jsx(\"div\", {\n    className: \"jsx-2222252425\" + \" \" + \"container\"\n  }, __jsx(Top, null), __jsx(\"form\", {\n    onSubmit: uploadPhoto,\n    className: \"jsx-2222252425\"\n  }, __jsx(Content, {\n    click: fileClick,\n    setPhotoFiles: setPhotoFiles,\n    PhotoFiles: PhotoFiles\n  }), PhotoFiles.length > 0 && __jsx(AddBu, {\n    click: fileClick\n  }), __jsx(Form, {\n    ref: fileRef,\n    setFile: setPhotoFiles\n  }, __jsx(\"div\", {\n    onClick: e => e.target.hidden = true,\n    hidden: true,\n    className: \"jsx-2222252425\" + \" \" + \"remind\"\n  }, \"\\u8BF7\\u6DFB\\u52A0\\u81F3\\u5C11\\u4E00\\u5F20\\u7167\\u7247\")))), __jsx(\"canvas\", {\n    ref: ref => canvasRef = ref,\n    hidden: true,\n    style: {\n      position: 'fixed',\n      left: 0,\n      top: 0,\n      zIndex: 99\n    },\n    className: \"jsx-2222252425\"\n  }), __jsx(_JSXStyle, {\n    id: \"2222252425\"\n  }, [\".add-photo.jsx-2222252425{position:fixed;top:0;left:0;height:100vh;width:100vw;background:#f4f7f9;z-index:10;}\", \".user.jsx-2222252425{position:fixed;top:50%;left:40px;-webkit-transform:translate(0,-50%);-ms-transform:translate(0,-50%);transform:translate(0,-50%);}\", \".container.jsx-2222252425::-webkit-scrollbar{display:none;}\", \".container.jsx-2222252425{height:100%;width:980px;margin:0 auto;background:white;box-shadow:0 0 4px #eee;overflow:auto;padding-bottom:40vh;}\", \".remind.jsx-2222252425{width:90%;height:50px;border-radius:12px;color:white;text-align:center;line-height:50px;font-size:20px;background:red;-webkit-animation:go-jsx-2222252425 .2s;animation:go-jsx-2222252425 .2s;}\", \"@-webkit-keyframes go-jsx-2222252425{0%{-webkit-transform:scale(0.8);-ms-transform:scale(0.8);transform:scale(0.8);}100%{-webkit-transform:scale(1);-ms-transform:scale(1);transform:scale(1);}}\", \"@keyframes go-jsx-2222252425{0%{-webkit-transform:scale(0.8);-ms-transform:scale(0.8);transform:scale(0.8);}100%{-webkit-transform:scale(1);-ms-transform:scale(1);transform:scale(1);}}\"]));\n}\n\nexport default AddPhoto;","map":null,"metadata":{},"sourceType":"module"}