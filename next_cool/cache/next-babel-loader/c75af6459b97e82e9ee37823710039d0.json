{"ast":null,"code":"var _jsxFileName = \"C:\\\\test\\\\pages\\\\editusermessage\\\\show\\\\avatarLoadPhoto.js\";\nimport _JSXStyle from \"styled-jsx/style\";\nvar __jsx = React.createElement;\nimport React from 'react';\n\nfunction Loadphoto({\n  data\n}) {\n  const uploadBu = e => {\n    //上传图片按钮事件\n    e.target.nextElementSibling.click();\n  };\n\n  const fileChange = e => {\n    //上传图片文件解析事件\n    let img = document.createElement('img');\n    img.src = URL.createObjectURL(e.target.files[0]);\n    e.target.value = '';\n\n    img.onload = () => {\n      document.querySelector('.photo-container').append(img);\n      canvasFunc(img.offsetWidth, img.offsetHeight, img);\n    };\n  };\n\n  return __jsx(React.Fragment, null, __jsx(\"button\", {\n    onClick: uploadBu,\n    className: \"jsx-369983592\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 21\n    },\n    __self: this\n  }, \"\\u66F4\\u6362\\u5934\\u50CF\"), __jsx(\"input\", {\n    type: \"file\",\n    name: \"avatar-photo\",\n    id: \"photo\",\n    onChange: fileChange,\n    hidden: true,\n    className: \"jsx-369983592\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 24\n    },\n    __self: this\n  }), __jsx(\"div\", {\n    style: {\n      position: 'fixed',\n      left: 0,\n      top: 0,\n      visibility: 'hidden',\n      userSelect: 'none'\n    },\n    className: \"jsx-369983592\" + \" \" + \"photo-container\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 29\n    },\n    __self: this\n  }), __jsx(\"canvas\", {\n    id: \"canvas\",\n    hidden: true,\n    className: \"jsx-369983592\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 36\n    },\n    __self: this\n  }), __jsx(\"canvas\", {\n    id: \"canvas2\",\n    hidden: true,\n    className: \"jsx-369983592\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 39\n    },\n    __self: this\n  }), __jsx(_JSXStyle, {\n    id: \"369983592\",\n    __self: this\n  }, \"button.jsx-369983592{background:none;border:none;outline:none;color:#3897f0;font-weight:700;}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFx0ZXN0XFxwYWdlc1xcZWRpdHVzZXJtZXNzYWdlXFxzaG93XFxhdmF0YXJMb2FkUGhvdG8uanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBeUMyQixBQUc0QyxnQkFDSixZQUNDLGFBQ0MsY0FDRSxnQkFDbkIiLCJmaWxlIjoiQzpcXHRlc3RcXHBhZ2VzXFxlZGl0dXNlcm1lc3NhZ2VcXHNob3dcXGF2YXRhckxvYWRQaG90by5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCdcclxuXHJcbmZ1bmN0aW9uIExvYWRwaG90byh7ZGF0YX0pIHtcclxuICAgIGNvbnN0IHVwbG9hZEJ1ID0gKGUpID0+IHsgICAgICAvL+S4iuS8oOWbvueJh+aMiemSruS6i+S7tlxyXG4gICAgICAgIGUudGFyZ2V0Lm5leHRFbGVtZW50U2libGluZy5jbGljaygpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGZpbGVDaGFuZ2UgPSAoZSkgPT4geyAgICAgLy/kuIrkvKDlm77niYfmlofku7bop6PmnpDkuovku7ZcclxuICAgICAgIFxyXG4gICAgICAgbGV0IGltZyAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcclxuICAgICAgIGltZy5zcmMgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGUudGFyZ2V0LmZpbGVzWzBdKTtcclxuICAgICAgIGUudGFyZ2V0LnZhbHVlID0gJyc7IFxyXG4gICAgICAgaW1nLm9ubG9hZCA9ICgpID0+IHsgICBcclxuICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucGhvdG8tY29udGFpbmVyJykuYXBwZW5kKGltZyk7XHJcbiAgICAgICAgICAgY2FudmFzRnVuYyhpbWcub2Zmc2V0V2lkdGgsaW1nLm9mZnNldEhlaWdodCxpbWcpO1xyXG4gICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIChcclxuICAgICAgICA8PlxyXG4gICAgICAgICAgICAgICAgPGJ1dHRvbiBvbkNsaWNrPXt1cGxvYWRCdX0+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIOabtOaNouWktOWDj1xyXG4gICAgICAgICAgICAgICAgPC9idXR0b24+XHJcbiAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT1cImZpbGVcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lPVwiYXZhdGFyLXBob3RvXCJcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWQ9XCJwaG90b1wiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXtmaWxlQ2hhbmdlfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBoaWRkZW4vPlxyXG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJwaG90by1jb250YWluZXJcIiBzdHlsZT17e3Bvc2l0aW9uOidmaXhlZCcsXHJcbiAgICAgICAgICAgICAgICBsZWZ0OjAsdG9wOjAsXHJcbiAgICAgICAgICAgICAgICB2aXNpYmlsaXR5OidoaWRkZW4nLFxyXG4gICAgICAgICAgICAgICAgdXNlclNlbGVjdDonbm9uZScgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICB9fT5cclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICAgICAgICA8Y2FudmFzIGlkPVwiY2FudmFzXCIgaGlkZGVuPlxyXG4gICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIDwvY2FudmFzPlxyXG4gICAgICAgICAgICAgICAgPGNhbnZhcyBpZD1cImNhbnZhczJcIiBoaWRkZW4gPlxyXG4gICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgPC9jYW52YXM+XHJcbiAgICAgICAgICAgICAgPHN0eWxlIGpzeD4ge2BcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uIHsgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6bm9uZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvcmRlcjpub25lO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3V0bGluZTpub25lO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6IzM4OTdmMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvbnQtd2VpZ2h0OjcwMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBgfVxyXG4gICAgICAgICAgICAgIDwvc3R5bGU+ICAgICAgICAgICAgICAgXHJcbiAgICAgICAgPC8+XHJcbiAgICApXHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IExvYWRwaG90b1xyXG5cclxuXHJcbmNvbnN0IGNhbnZhc0Z1bmMgPSAoVyxILGltZykgPT4ge1xyXG4gICAgXHJcbiAgICAgICAgbGV0IGNhbnZhcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW52YXMnKTtcclxuICAgICAgICBsZXQgIGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xyXG4gICAgICAgIGxldCBjb3VudCA9IE1hdGgubWluKFcsSCk7XHJcbiAgICAgICAgY2FudmFzLndpZHRoID0gY291bnQ7XHJcbiAgICAgICAgY2FudmFzLmhlaWdodCA9IGNvdW50O1xyXG4gICAgICAgIGxldCB3ID0oTWF0aC5tYXgoVyxIKS1jb3VudCkvMjsgICAgXHJcbiAgICAgICAgVz5IP2N0eC5kcmF3SW1hZ2UoaW1nLC13LDApOiBjdHguZHJhd0ltYWdlKGltZywwLC13KTsgLy/oo4Hlh4/miJDkuIDmr5TkuIBcclxuICAgICAgICBcclxuXHJcbiAgICAgICAgbGV0IGN0eDIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FudmFzMicpLmdldENvbnRleHQoJzJkJyk7XHJcbiAgICAgICAgY2FudmFzMi53aWR0aCA9IDQwO1xyXG4gICAgICAgIGNhbnZhczIuaGVpZ2h0PSA0MDtcclxuICAgICAgICBjdHgyLmRyYXdJbWFnZShjYW52YXMsMCwwLDQwLDQwKTsgIC8vIOe8qeaUvuaIkDQwcHggNDBweFxyXG4gICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbnZhczInKS50b0Jsb2IoKGJsb2IpID0+IHsgIC8vIOi+k+WHuuWbvueJh1xyXG4gICAgICAgIGxldCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xyXG4gICAgICAgIGZvcm1EYXRhLmFwcGVuZChcImZpbGVcIixibG9iLCBcImltYWdlLnBuZ1wiKTtcclxuICAgICAgICBmZXRjaCgnaHR0cDovL2xvY2FsaG9zdDozMDAxL2dldHBob3Rvcy8vYXZhdGFyJyxcclxuICAgICAgICB7bWV0aG9kOidQT1NUJyxib2R5OmZvcm1EYXRhLGNyZWRlbnRpYWxzOiBcImluY2x1ZGVcIn0pXHJcbiAgICAgICAgLnRoZW4ocmVzID0+IHJlcy5qc29uKCkpXHJcbiAgICAgICAgLnRoZW4ocmVzdWx0ID0+IGltZyk7XHJcbiAgICAgICAgLy8gbGV0IGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7XHJcbiAgICAgICAgLy8gbGluay5kb3dubG9hZCA9ICdsaWtlLmpwZyc7XHJcbiAgICAgICAgLy8gbGluay5ocmVmID0gVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTtcclxuICAgICAgICAvLyBsaW5rLmNsaWNrKCk7XHJcbiAgICAgICAgLy8gVVJMLnJldm9rZU9iamVjdFVSTChsaW5rLmhyZWYpOyAgLy/liKDpmaRibG9iIOWGheWtmOe8k+WtmFxyXG4gICAgfSwnaW1hZ2UvcG5nJylcclxuICAgIFxyXG59Il19 */\\n/*@ sourceURL=C:\\\\\\\\test\\\\\\\\pages\\\\\\\\editusermessage\\\\\\\\show\\\\\\\\avatarLoadPhoto.js */\"));\n}\n\nexport default Loadphoto;\n\nconst canvasFunc = (W, H, img) => {\n  let canvas = document.getElementById('canvas');\n  let ctx = canvas.getContext('2d');\n  let count = Math.min(W, H);\n  canvas.width = count;\n  canvas.height = count;\n  let w = (Math.max(W, H) - count) / 2;\n  W > H ? ctx.drawImage(img, -w, 0) : ctx.drawImage(img, 0, -w); //裁减成一比一\n\n  let ctx2 = document.getElementById('canvas2').getContext('2d');\n  canvas2.width = 40;\n  canvas2.height = 40;\n  ctx2.drawImage(canvas, 0, 0, 40, 40); // 缩放成40px 40px\n\n  document.getElementById('canvas2').toBlob(blob => {\n    // 输出图片\n    let formData = new FormData();\n    formData.append(\"file\", blob, \"image.png\");\n    fetch('http://localhost:3001/getphotos//avatar', {\n      method: 'POST',\n      body: formData,\n      credentials: \"include\"\n    }).then(res => res.json()).then(result => img); // let link = document.createElement('a');\n    // link.download = 'like.jpg';\n    // link.href = URL.createObjectURL(blob);\n    // link.click();\n    // URL.revokeObjectURL(link.href);  //删除blob 内存缓存\n  }, 'image/png');\n};","map":{"version":3,"sources":["C:/test/pages/editusermessage/show/avatarLoadPhoto.js"],"names":["React","Loadphoto","data","uploadBu","e","target","nextElementSibling","click","fileChange","img","document","createElement","src","URL","createObjectURL","files","value","onload","querySelector","append","canvasFunc","offsetWidth","offsetHeight","position","left","top","visibility","userSelect","W","H","canvas","getElementById","ctx","getContext","count","Math","min","width","height","w","max","drawImage","ctx2","canvas2","toBlob","blob","formData","FormData","fetch","method","body","credentials","then","res","json","result"],"mappings":"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","sourcesContent":["import React from 'react'\r\n\r\nfunction Loadphoto({data}) {\r\n    const uploadBu = (e) => {      //上传图片按钮事件\r\n        e.target.nextElementSibling.click();\r\n    }\r\n\r\n    const fileChange = (e) => {     //上传图片文件解析事件\r\n       \r\n       let img  = document.createElement('img');\r\n       img.src = URL.createObjectURL(e.target.files[0]);\r\n       e.target.value = ''; \r\n       img.onload = () => {   \r\n                 \r\n           document.querySelector('.photo-container').append(img);\r\n           canvasFunc(img.offsetWidth,img.offsetHeight,img);\r\n       }\r\n    }\r\n    return (\r\n        <>\r\n                <button onClick={uploadBu}>\r\n                        更换头像\r\n                </button>\r\n                <input type=\"file\"\r\n                        name=\"avatar-photo\"\r\n                        id=\"photo\"\r\n                        onChange={fileChange}\r\n                        hidden/>\r\n                <div className=\"photo-container\" style={{position:'fixed',\r\n                left:0,top:0,\r\n                visibility:'hidden',\r\n                userSelect:'none'                \r\n                }}>\r\n                \r\n                </div>\r\n                <canvas id=\"canvas\" hidden>\r\n                     \r\n                </canvas>\r\n                <canvas id=\"canvas2\" hidden >\r\n                    \r\n                </canvas>\r\n              <style jsx> {`\r\n                        button {                        \r\n                            background:none;\r\n                            border:none;\r\n                            outline:none;\r\n                            color:#3897f0;\r\n                            font-weight:700;\r\n                        }\r\n                        `}\r\n              </style>               \r\n        </>\r\n    )\r\n}\r\n\r\nexport default Loadphoto\r\n\r\n\r\nconst canvasFunc = (W,H,img) => {\r\n    \r\n        let canvas = document.getElementById('canvas');\r\n        let  ctx = canvas.getContext('2d');\r\n        let count = Math.min(W,H);\r\n        canvas.width = count;\r\n        canvas.height = count;\r\n        let w =(Math.max(W,H)-count)/2;    \r\n        W>H?ctx.drawImage(img,-w,0): ctx.drawImage(img,0,-w); //裁减成一比一\r\n        \r\n\r\n        let ctx2 = document.getElementById('canvas2').getContext('2d');\r\n        canvas2.width = 40;\r\n        canvas2.height= 40;\r\n        ctx2.drawImage(canvas,0,0,40,40);  // 缩放成40px 40px\r\n       document.getElementById('canvas2').toBlob((blob) => {  // 输出图片\r\n        let formData = new FormData();\r\n        formData.append(\"file\",blob, \"image.png\");\r\n        fetch('http://localhost:3001/getphotos//avatar',\r\n        {method:'POST',body:formData,credentials: \"include\"})\r\n        .then(res => res.json())\r\n        .then(result => img);\r\n        // let link = document.createElement('a');\r\n        // link.download = 'like.jpg';\r\n        // link.href = URL.createObjectURL(blob);\r\n        // link.click();\r\n        // URL.revokeObjectURL(link.href);  //删除blob 内存缓存\r\n    },'image/png')\r\n    \r\n}"]},"metadata":{},"sourceType":"module"}