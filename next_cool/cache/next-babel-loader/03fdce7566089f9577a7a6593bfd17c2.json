{"ast":null,"code":"import _JSXStyle from \"styled-jsx/style\";\nvar __jsx = React.createElement;\nimport React from 'react';\n\nfunction Loadphoto({\n  data\n}) {\n  const uploadBu = e => {\n    //上传图片按钮事件\n    e.target.nextElementSibling.click();\n  };\n\n  const fileChange = e => {\n    //上传图片文件解析事件\n    let img = document.createElement('img');\n    img.src = URL.createObjectURL(e.target.files[0]);\n    e.target.value = '';\n\n    img.onload = () => {\n      document.querySelector('.photo-container').append(img);\n      canvasFunc(img.offsetWidth, img.offsetHeight, img);\n    };\n  };\n\n  return __jsx(React.Fragment, null, __jsx(\"button\", {\n    onClick: uploadBu,\n    className: \"jsx-369983592\"\n  }, \"\\u66F4\\u6362\\u5934\\u50CF\"), __jsx(\"input\", {\n    type: \"file\",\n    name: \"avatar-photo\",\n    id: \"photo\",\n    onChange: fileChange,\n    hidden: true,\n    className: \"jsx-369983592\"\n  }), __jsx(\"div\", {\n    style: {\n      position: 'fixed',\n      left: 0,\n      top: 0,\n      visibility: 'hidden',\n      userSelect: 'none'\n    },\n    className: \"jsx-369983592\" + \" \" + \"photo-container\"\n  }), __jsx(\"canvas\", {\n    id: \"canvas\",\n    hidden: true,\n    className: \"jsx-369983592\"\n  }), __jsx(\"canvas\", {\n    id: \"canvas2\",\n    hidden: true,\n    className: \"jsx-369983592\"\n  }), __jsx(_JSXStyle, {\n    id: \"369983592\"\n  }, [\"button.jsx-369983592{background:none;border:none;outline:none;color:#3897f0;font-weight:700;}\"]));\n}\n\nexport default Loadphoto;\n\nconst canvasFunc = (W, H, img) => {\n  let canvas = document.getElementById('canvas');\n  let ctx = canvas.getContext('2d');\n  let count = Math.min(W, H);\n  canvas.width = count;\n  canvas.height = count;\n  let w = (Math.max(W, H) - count) / 2;\n  W > H ? ctx.drawImage(img, -w, 0) : ctx.drawImage(img, 0, -w); //裁减成一比一\n\n  let ctx2 = document.getElementById('canvas2').getContext('2d');\n  canvas2.width = 40;\n  canvas2.height = 40;\n  ctx2.drawImage(canvas, 0, 0, 40, 40); // 缩放成40px 40px\n\n  document.getElementById('canvas2').toBlob(blob => {\n    // 输出图片\n    let formData = new FormData();\n    formData.append(\"file\", blob, \"image.png\");\n    fetch('http://localhost:3001/getphotos//avatar', {\n      method: 'POST',\n      body: formData,\n      credentials: \"include\"\n    }).then(res => res.json()).then(result => img); // let link = document.createElement('a');\n    // link.download = 'like.jpg';\n    // link.href = URL.createObjectURL(blob);\n    // link.click();\n    // URL.revokeObjectURL(link.href);  //删除blob 内存缓存\n  }, 'image/png');\n};","map":null,"metadata":{},"sourceType":"module"}